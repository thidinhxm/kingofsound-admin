{{> header }}
<div class="container mt-5">

  <div class="col-12 ">
    <div div="row">
      <form action="/accounts/users" method="get">
        <div class="wrap">
          <div class="search" style="margin: 20px auto;">
            <input type="text" class="searchTerm" placeholder="Người dùng bạn tìm kiếm là ?" id="search_name"
              name="search_name" value="{{search_name}}">
            <button type="submit" class="searchButton">
              <i class="fa fa-search"></i>
            </button>
          </div>
      </form>
    </div>


    <div class="tm-bg-primary-dark ">

      <table class="table">
        <thead>
          {{#if Pages}}
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Tên khách hàng</th>
            <th scope="col">Email</th>
            <th scope="col">Trạng thái</th>
            <th scope="col">Chi tiết</th>
          </tr>
        </thead>
        <tbody>
          {{#each userAccounts}}
          <tr>
            <th scope="row"><b>{{user_id}}</b></th>
            <td><b>{{firstname}} {{lastname}}</b></td>
            <td><b>{{email}}</b></td>
            <td>
              {{#if (isBlockedAccount is_blocked)}}
              {{!-- <button><i class="fas fa-lock"></i>Locked</button> --}}
              <a href="" class="tm-product-delete-link btn-danger" data-toggle="modal" data-target="#unlock-user-modal"
                data-id="{{user_id}}">
                <i class="fas fa-lock tm-product-delete-icon"></i>
              </a>
              {{/if}}


            </td>
            <td>
              <a href="/accounts/users/{{user_id}}/profile" class=" tm-product-delete-link">
                <i class="far fa-eye tm-product-delete-icon"></i>
              </a>
            </td>
          </tr>

          {{!-- Confirm Unlock account modal --}}
          <div id="unlock-user-modal" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Mở khoá người dùng</h5>
                  <button type="button" class="close" data-dismiss="modal" data-id="" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <p>Bạn chắc chắn muốn mở khoá người dùng này ?</p>
                </div>
                <div class="modal-footer">
                  <button id="btn-unlock-user" type="button" class=" btn btn-danger" method="post">Mở khoá</button>
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Quay lại</button>
                </div>
              </div>
            </div>
          </div>

          <form method="post" name="unlock-user-form" action="/accounts/{{user_id}}/unlock/">
          </form>


          {{!-- End Unlock account modal --}}



          {{/each}}
          {{else}}
          <h1 class="Notification">Không có người dùng nào phù hợp!</h1>
          {{/if}}
        </tbody>
      </table>
    </div>
  </div>
</div>
{{#if Pages}}
<nav aria-label="Page navigation example" style="margin-top: 20px;">
  <ul class="pagination pagination-sm" style="display: flex; justify-content: center;">
    <li class="page-item">
      <a class="page-link" href="#" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
        <span class="sr-only">Previous</span>
      </a>
    </li>
    {{#if search_name}}
    {{#pages Pages search_name}}
    <li class="page-item"><a class="page-link" href="?search_name={{search_name}}&page={{index}}">{{index}}</a>
    </li>
    {{/pages}}
    {{else}}
    {{#pages Pages search_name}}
    <li class="page-item"><a class="page-link" href="?page={{index}}">{{index}}</a></li>
    {{/pages}}
    {{/if}}
    <li class="page-item">
      <a class="page-link" href="#" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
        <span class="sr-only">Next</span>
      </a>
    </li>
  </ul>
</nav>
{{/if}}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var productID
    var unlockForm = document.forms['unlock-user-form'];
    $('#unlock-user-modal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget) // Button that triggered the modal
      userID = button.data('id')

    });

    var btnUnlockForm = document.getElementById('btn-unlock-user');

    btnUnlockForm.onclick = function () {
      unlockForm.action = '/accounts/users/' + userID + '/unlock';
      unlockForm.submit();
    }

  });

</script>